<!DOCTYPE html>
<html>
<head>
    <title>Admin - RSS & Prompts Management</title>
    <link rel="stylesheet" href="/static/css/brand.css">
    <style>
        .admin-section { background: white; padding: var(--space-6); margin: var(--space-6) 0; border-radius: var(--radius-lg); box-shadow: var(--shadow-md); }
        .feed-card { background: var(--gray-50); padding: var(--space-6); margin: var(--space-4) 0; border-radius: var(--radius-lg); border-left: 4px solid var(--primary-blue); }
        .feed-name { font-size: 1.25rem; font-weight: 600; margin-bottom: var(--space-2); color: var(--gray-900); }
        .feed-url { color: var(--gray-600); font-size: 0.875rem; margin-bottom: var(--space-4); word-break: break-all; }
        .status-toggle { display: inline-block; padding: var(--space-2) var(--space-4); border-radius: var(--radius-xl); font-size: 0.875rem; cursor: pointer; font-weight: 500; }
        .status-active { background: var(--success-green-light); color: var(--success-green); }
        .status-paused { background: var(--danger-red-light); color: var(--danger-red); }
        .prompt-section { margin: var(--space-6) 0; padding: var(--space-4); background: var(--warning-orange-light); border-radius: var(--radius-md); }
        .prompt-title { font-weight: 600; margin-bottom: var(--space-3); color: var(--warning-orange); }
        .add-rss-form { background: var(--gray-50); padding: var(--space-8); border-radius: var(--radius-lg); margin-bottom: var(--space-6); border: 1px solid var(--gray-200); }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-6); }
        .form-grid .full-width { grid-column: 1 / -1; }
        .form-input { width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 0.875rem; transition: all 0.2s; }
        .form-input:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px var(--primary-blue-light); }
        .form-textarea { width: 100%; padding: var(--space-3); border: 2px solid var(--gray-200); border-radius: var(--radius-md); font-size: 0.875rem; min-height: 120px; font-family: var(--font-mono); transition: all 0.2s; resize: vertical; }
        .form-textarea:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px var(--primary-blue-light); }
        .form-label { display: block; margin-bottom: var(--space-2); font-weight: 600; color: var(--gray-700); font-size: 0.875rem; }
        .section-title { font-size: 1.5rem; font-weight: 700; color: var(--gray-900); margin-bottom: var(--space-6); display: flex; align-items: center; gap: var(--space-2); }
    </style>
</head>
<body>
    <div class="header">
        <h1>‚öôÔ∏è Admin Panel</h1>
        <p>Manage RSS feeds and customize prompts</p>
    </div>

    <div class="nav-tabs">
        <a href="/" class="nav-tab">Dashboard</a>
        {% for feed in feeds %}
        <a href="/rss/{{ feed[0] }}" class="nav-tab">{{ feed[1] }}</a>
        {% endfor %}
        <a href="/admin" class="nav-tab active">‚öôÔ∏è Admin</a>
    </div>

    <div class="container">
        <!-- Add New RSS Feed -->
        <div class="admin-section">
            <h2 class="section-title">
                <span>‚ûï</span>
                <span>Add New RSS Feed</span>
            </h2>
            <div class="add-rss-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">üì° Feed Name</label>
                        <input type="text" id="new-feed-name" class="form-input" placeholder="e.g., Mobile Development Jobs">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîó RSS URL</label>
                        <input type="url" id="new-feed-url" class="form-input" placeholder="https://www.vollna.com/rss/...">
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">üîç Keyword Extraction Prompt</label>
                        <textarea id="new-keyword-prompt" class="form-textarea" placeholder="Prompt for extracting keywords from job descriptions...">Extract 2 non-technical, functionality-based keywords from this job description for app searching.
Focus on industry/category and main function (e.g., "healthcare booking", "food delivery").
If too technical, use generic categories.

Job: {job_description}

Return only 2 keywords separated by comma:</textarea>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">üìù Proposal Generation Prompt</label>
                        <textarea id="new-proposal-prompt" class="form-textarea" placeholder="Prompt for generating proposals...">Generate a Proposalgenie-format proposal for this job:

Job Title: {job_title}
Job Description: {job_description}

Work Examples: {examples_text}

Follow the exact format:
- Start with: {greeting}
- Short intro with role + years + specialization
- Paragraph 1: technical fit + expected result
- Paragraph 2: Work examples (use the provided examples)
- Paragraph 3: exactly 2 thoughtful developer/designer questions
- Paragraph 4: CTA with call availability

Use Unicode formatting, no markdown. Be conversational but professional.</textarea>
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">üîç Olostep Enrichment Prompt</label>
                        <textarea id="new-olostep-prompt" class="form-textarea" placeholder="Prompt for client enrichment...">Find contact info for {search_target} in {city}, {country}. Get LinkedIn, email, phone, WhatsApp.</textarea>
                    </div>
                </div>
                <div style="margin-top: var(--space-6); text-align: center;">
                    <button class="btn btn-success btn-lg" onclick="addRSSFeed()">‚úÖ Add RSS Feed</button>
                </div>
            </div>
        </div>

        <!-- Existing RSS Feeds -->
        <div class="admin-section">
            <h2 class="section-title">
                <span>üì°</span>
                <span>Manage RSS Feeds</span>
            </h2>
            
            {% for feed in feeds %}
            <div class="feed-card" id="feed-{{ feed[0] }}">
                <div class="feed-name">{{ feed[1] }}</div>
                <div class="feed-url">{{ feed[2] }}</div>
                
                <div style="margin: 15px 0;">
                    <span class="status-toggle {% if feed[3] == 1 %}status-active{% else %}status-paused{% endif %}" 
                          onclick="toggleRSSStatus({{ feed[0] }})">
                        {% if feed[3] == 1 %}üü¢ Active{% else %}‚è∏Ô∏è Paused{% endif %}
                    </span>
                </div>

                <!-- Prompts Section -->
                <div class="prompt-section">
                    <div class="prompt-title">üîß Custom Prompts</div>
                    
                    <div class="form-group">
                        <label>Keyword Extraction Prompt:</label>
                        <textarea id="keyword-prompt-{{ feed[0] }}">{{ feed[4] or '' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Proposal Generation Prompt:</label>
                        <textarea id="proposal-prompt-{{ feed[0] }}">{{ feed[5] or '' }}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Olostep Enrichment Prompt:</label>
                        <textarea id="olostep-prompt-{{ feed[0] }}">{{ feed[6] or '' }}</textarea>
                    </div>
                    
                    <button class="btn btn-primary" onclick="updatePrompts({{ feed[0] }})">üíæ Save Prompts</button>
                    <button class="btn btn-warning" onclick="resetPrompts({{ feed[0] }})">üîÑ Reset to Default</button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function addRSSFeed() {
            const name = document.getElementById('new-feed-name').value;
            const url = document.getElementById('new-feed-url').value;
            const keywordPrompt = document.getElementById('new-keyword-prompt').value;
            const proposalPrompt = document.getElementById('new-proposal-prompt').value;
            const olostepPrompt = document.getElementById('new-olostep-prompt').value;
            
            if (!name || !url || !keywordPrompt || !proposalPrompt || !olostepPrompt) {
                alert('Please fill all fields');
                return;
            }
            
            fetch('/add_rss', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    name: name,
                    url: url,
                    keyword_prompt: keywordPrompt,
                    proposal_prompt: proposalPrompt,
                    olostep_prompt: olostepPrompt
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('RSS feed added successfully!');
                    location.reload();
                } else {
                    alert('Error adding RSS feed');
                }
            })
            .catch(error => {
                alert('Error: ' + error);
            });
        }
        
        function toggleRSSStatus(rssId) {
            fetch(`/toggle_rss/${rssId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'}
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('Error toggling RSS status');
                }
            });
        }
        
        function updatePrompts(rssId) {
            const keywordPrompt = document.getElementById(`keyword-prompt-${rssId}`).value;
            const proposalPrompt = document.getElementById(`proposal-prompt-${rssId}`).value;
            const olostepPrompt = document.getElementById(`olostep-prompt-${rssId}`).value;
            
            fetch(`/update_prompts/${rssId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    keyword_prompt: keywordPrompt,
                    proposal_prompt: proposalPrompt,
                    olostep_prompt: olostepPrompt
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Prompts updated successfully!');
                } else {
                    alert('Error updating prompts');
                }
            });
        }
        
        function resetPrompts(rssId) {
            if (!confirm('Are you sure you want to reset prompts to default?')) {
                return;
            }
            
            const defaultKeyword = `Extract 2 non-technical, functionality-based keywords from this job description for app searching.
Focus on industry/category and main function (e.g., "healthcare booking", "food delivery").
If too technical, use generic categories.

Job: {job_description}

Return only 2 keywords separated by comma:`;

            const defaultProposal = `Generate a Proposalgenie-format proposal for this job:

Job Title: {job_title}
Job Description: {job_description}

Work Examples: {examples_text}

Follow the exact format:
- Start with: {greeting}
- Short intro with role + years + specialization
- Paragraph 1: technical fit + expected result
- Paragraph 2: Work examples (use the provided examples)
- Paragraph 3: exactly 2 thoughtful developer/designer questions
- Paragraph 4: CTA with call availability

Use Unicode formatting, no markdown. Be conversational but professional.`;

            const defaultOlostep = `Find contact info for {search_target} in {city}, {country}. Get LinkedIn, email, phone, WhatsApp.`;
            
            document.getElementById(`keyword-prompt-${rssId}`).value = defaultKeyword;
            document.getElementById(`proposal-prompt-${rssId}`).value = defaultProposal;
            document.getElementById(`olostep-prompt-${rssId}`).value = defaultOlostep;
            
            updatePrompts(rssId);
        }
    </script>
</body>
</html>